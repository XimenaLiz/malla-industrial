<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Curricular - ULIMA</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f6f5fa;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      color: #5d3d9c;
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }
    .tabs button {
      padding: 0.5rem 1rem;
      background: #e0ddf5;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      color: #5d3d9c;
    }
    .tabs button.active {
      background: #7c66e3;
      color: white;
    }
    .grid {
      display: flex;
      gap: 1.5rem;
      overflow-x: auto;
      padding-bottom: 1rem;
    }
    .ciclo-col {
      min-width: 250px;
      flex-shrink: 0;
      background-color: #ffffff;
      border-radius: 1.5rem;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
      padding: 1rem;
    }
    .ciclo-title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: #5d3d9c;
      text-align: center;
    }
    .curso {
      background-color: #e9ecfb;
      border-left: 6px solid #7c66e3;
      padding: 0.75rem;
      border-radius: 1rem;
      margin-bottom: 0.75rem;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .curso.completado {
      text-decoration: line-through;
      opacity: 0.4;
    }
    .curso.bloqueado {
      opacity: 0.3;
    }
    .info-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: #7c66e3;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      z-index: 2;
    }
    .action-btn {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      display: flex;
      gap: 0.3rem;
    }
    .action-btn button {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 14px;
      color: #5d3d9c;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      padding: 1.5rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      border-radius: 1.5rem;
      z-index: 99;
      max-width: 450px;
      width: 90%;
    }
    .popup h3 {
      margin-top: 0;
      color: #5d3d9c;
    }
    .popup small {
      display: block;
      margin-bottom: 0.5rem;
      color: #444;
    }
    .popup button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #5d3d9c;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 98;
    }
    .hidden { display: none; }
    .curso-title {
      font-weight: 600;
      color: #333;
    }
    .alerta-desbloqueo {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: #7c66e3;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      z-index: 100;
      animation: fadeInOut 3s ease forwards;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .alerta-desbloqueo img {
      width: 24px;
      height: 24px;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { opacity: 0; }
    }
    form {
      margin-top: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 1rem;
      max-width: 550px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }
    form input, form textarea {
      width: 97%;
      margin-bottom: 1rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
    }
    form button {
      background: #5d3d9c;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .electivo {
      background-color: #ffe9ec;
      border-left: 6px solid #d94e6a;
      padding: 0.75rem;
      border-radius: 1rem;
      margin-bottom: 0.75rem;
      position: relative;
      cursor: grab;
      width: 220px;
    }
    .electivo.dragging {
      opacity: 0.4;
    }
    .electivo .info-btn {
      background-color: #d94e6a;
    }
    .electivo-dropzone {
      min-width: 250px;
      flex-shrink: 0;
      background-color: #fff4f5;
      border-radius: 1.5rem;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
      padding: 1rem;
    }
    .electivo-title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: #d94e6a;
      text-align: center;
    }
    .electivos-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      padding: 1rem;
      margin-bottom: 2rem;
    }
  #electivos-contenedor {
  margin-top: 40px;
}

.cursos-electivos-flex {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: flex-start;
}
/* Estilo para distintivos de diplomas */
.badge {
  display: inline-block;
  font-size: 12px;
  background-color: #ccc;
  color: white;
  padding: 2px 6px;
  border-radius: 8px;
  margin-left: 6px;
  font-weight: 600;
}

/* Colores por diploma */
.badge.IT { background-color: #7b9acc; }       /* Innovación Tecnológica */
.badge.BA { background-color: #e88941; }       /* Business Analytics */
.badge.SCM { background-color: #4dbf98; }      /* Supply Chain */
.badge.EPM { background-color: #c875c4; }      /* Engineering Project Mgmt */
.badge.IE { background-color: #f1b21d; }       /* Ingeniería Empresarial */
.badge.ninguno { background-color: #aaa; }     /* Sin diploma */

/* Filtro Toggle de diplomas */
.filtros-diplomas {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.filtros-diplomas button {
  background-color: #e0ddf5;
  color: #5d3d9c;
  border: none;
  padding: 0.4rem 0.8rem;
  border-radius: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.filtros-diplomas button.active {
  background-color: #5d3d9c;
  color: white;
}
.badge {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 12px;
  font-size: 0.7rem;
  margin-top: 4px;
  margin-bottom: 6px;
  background-color: #ccc;
  color: white;
}
.badge.IT { background-color: #4caf50; }     /* Verde */
.badge.BA { background-color: #2196f3; }     /* Azul */
.badge.SCM { background-color: #ff9800; }    /* Naranja */
.badge.EPM { background-color: #9c27b0; }    /* Púrpura */
.badge.IE { background-color: #f44336; }     /* Rojo */
.badge.ninguno { background-color: #607d8b; }/* Gris */
.filtros-diplomas {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.5rem;
  margin: 1rem auto;
}
.filtros-diplomas button {
  padding: 0.5rem 1rem;
  background: #eee;
  border: none;
  border-radius: 1rem;
  cursor: pointer;
  transition: 0.2s;
}
.filtros-diplomas button:hover {
  background: #ddd;
}
.filtros-diplomas button.active {
  background: #5d3d9c;
  color: white;
}
.electivo {
  padding: 0.5rem 0.6rem;
  margin-bottom: 0.6rem;
  font-size: 0.85rem;
  line-height: 1.2;
}

.electivo .curso-title {
  font-size: 0.90rem;
  margin-bottom: 0.25rem;
}

.electivo small {
  font-size: 0.7rem;
  color: #444;
  line-height: 1.1;
}
.electivo .curso-title {
  padding-right: 30px; /* espacio para que no choque con el ícono */
  display: block;
  word-wrap: break-word; /* permite que el texto largo se divida si es necesario */
}
.alerta-creditos {
  background-color: #fff3cd;
  border: 1px solid #ffeeba;
  padding: 10px;
  margin-top: 10px;
  border-radius: 8px;
  color: #856404;
  font-size: 0.95em;
}
.alerta-sirena {
  color: red;
  font-size: 1.2em;
  margin-right: 5px;
  animation: parpadeo 1.2s infinite;
  vertical-align: middle;
}

@keyframes parpadeo {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.2; }
}
.popup-tabs {
  display: flex;
  margin-bottom: 1rem;
  gap: 0.5rem;
}

.popup-tabs .tab-button {
  flex: 1;
  padding: 0.6rem;
  background: #e0ddf5;
  color: #5d3d9c;
  border: none;
  border-radius: 0.75rem 0.75rem 0 0;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s;
}

.popup-tabs .tab-button.active {
  background: #7c66e3;
  color: white;
}

.tab-content {
  display: none;
  padding: 1rem;
  border: 2px solid #7c66e3;
  border-top: none;
  border-radius: 0 0 0.75rem 0.75rem;
  background: #f6f5fa;
}

.tab-content.active {
  display: block;
}
  </style>
</head>
<body>
  <h1>Malla Curricular - ULIMA</h1>
  <div id="creditos-container" style="margin: 1rem auto; max-width: 500px; text-align: center;">
  <div id="creditos-texto" style="font-weight: bold; margin-bottom: 0.5rem;">Créditos aprobados: 0 / 200</div>
  <div style="background: #eee; height: 20px; border-radius: 10px; overflow: hidden;">
    <div id="creditos-barra" style="height: 100%; width: 0%; background: #4caf50; transition: width 0.3s;"></div>
  </div>
</div>

  <div class="tabs" id="carreras">
    <button class="active" onclick="cambiarCarrera('ingenieria')">Ingeniería Industrial</button>
  <button onclick="cambiarCarrera('personalizada')">Personalizada</button>
  </div>
  <div class="grid" id="malla"></div>

  <form id="formulario-personalizado" class="hidden" onsubmit="agregarCurso(event)">
    <h3>Agregar curso personalizado</h3>
    <input type="text" id="curso-nombre" placeholder="Nombre del curso" required>
    <input type="text" id="curso-codigo" placeholder="Código del curso">
    <input type="number" id="curso-creditos" placeholder="Créditos" required>
    <input type="number" id="curso-ciclo" placeholder="Ciclo" required>
    <input type="text" id="curso-prerreq" placeholder="Prerrequisitos (separados por coma)">
    <textarea id="curso-descripcion" placeholder="Descripción del curso"></textarea>
    <button type="submit">Agregar curso</button>
  </form>

<div id="overlay" class="overlay hidden"></div>
<div id="popup" class="popup hidden"></div>

<!-- Cursos Electivos sin agrupación -->
<div id="electivos-contenedor" style="margin-top: 2rem;">
<h2 style="text-align: center; color: #5d3d9c;">Cursos Electivos</h2>
<!-- Filtros por diploma -->
<div class="filtros-diplomas">
  <button onclick="filtrarDiploma('todos')" class="active">Todos</button>
  <button onclick="filtrarDiploma('IT')">Innovación Tecnológica</button>
  <button onclick="filtrarDiploma('BA')">Business Analytics</button>
  <button onclick="filtrarDiploma('SCM')">Supply Chain Mgmt</button>
  <button onclick="filtrarDiploma('EPM')">Engineering PM</button>
  <button onclick="filtrarDiploma('IE')">Ing. Empresarial</button>
  <button onclick="filtrarDiploma('Sin Diploma')">Sin Diploma</button>
</div>

<div id="electivos-container" class="electivos-flex"></div>
</div>

  <footer style="text-align: center; font-size: 0.85rem; color: #666; margin-top: 2rem;">
    <p>
      Creado por <strong>Adriana Lizares</strong> ❤️<br>
      Contacto: <a href="mailto:soportemallainteractiva@gmail.com">soportemallainteractiva@gmail.com</a><br>
      Última actualización: <span id="fecha-actualizacion"></span>
    </p>
  </footer>

  <script>
    document.getElementById("fecha-actualizacion").textContent = new Date().toLocaleDateString("es-PE", {
      year: 'numeric', month: 'long', day: 'numeric'
    });

    const carreras = {
      ingenieria: [
        { ciclo: 1, curso: "Matemática básica", codigo: "6382", creditos: 5, prerrequisitos: [], descripcion: "Conjuntos de números reales, ecuaciones e inecuaciones, geometría analítica y funciones. Se enfatizan, asimismo, las representaciones gráficas en el plano cartesiano y en el tratamiento introductorio a las funciones reales." },
        { ciclo: 1, curso: "Metodologías de la Investigación", codigo: "6508", creditos: 3, prerrequisitos: [], descripcion: "Busca desarrollar en los estudiantes la capacidad de formular, desarrollar y comunicar proyectos de investigación sólidos y pertinentes, tanto en el ámbito académico como profesional. Se centra en el dominio de técnicas e instrumentos del método científico, promoviendo el pensamiento crítico y objetivo." },
        { ciclo: 1, curso: "Desarrollo Personal y Social", codigo: "6505", creditos: 3, prerrequisitos: [], descripcion: "Conocer las principales características y procesos cognitivos y afectivos que explican el comportamiento humano a nivel individual y social. Permite al estudiante optimizar la comprensión de sí mismo y de su entorno mediante el análisis de casos." },
        { ciclo: 1, curso: "Lenguaje y Comunicación I", codigo: "510003", creditos: 4, prerrequisitos: [], descripcion: "Promueve la comprensión lectora de textos académicos, la redacción de textos expositivos, la expresión oral y la participación en la vida académica. Se enseña gramática, ortografía y estrategias de redacción propias del registro formal." },
        { ciclo: 1, curso: "Introducción a la Ingeniería", codigo: "510005", creditos: 3, prerrequisitos: [], descripcion: "Conocer las principales características y procesos del comportamiento humano en la ingeniería. Permite optimizar la comprensión de uno mismo y del entorno desde una perspectiva profesional." },
        { ciclo: 1, curso: "Ética cívica", codigo: "510004", creditos: 2, prerrequisitos: [], descripcion: "Incentiva la reflexión sobre valores esenciales para la convivencia en sociedades actuales y el análisis crítico de problemas sociales desde un enfoque ético-cívico. Promueve el diálogo y la responsabilidad social en contextos universitarios." },
        
        { ciclo: 2, curso: "Cálculo I", codigo: "6503", creditos: 5, prerrequisitos: ["Matemática básica"], descripcion: "Desarrolla habilidades de razonamiento lógico mediante el cálculo diferencial e integral en una variable real. Incluye funciones trigonométricas, límites, derivadas e integrales." },
        { ciclo: 2, curso: "Álgebra Lineal", codigo: "6384", creditos: 3, prerrequisitos: ["Matemática básica"], descripcion: "Desarrolla competencias para resolver problemas de ingeniería con vectores y matrices. Aborda álgebra vectorial y matricial." },
        { ciclo: 2, curso: "Economía y Empresa", codigo: "6510", creditos: 3, prerrequisitos: [], descripcion: "Proporciona los lineamientos básicos del análisis económico y empresarial. Incluye teoría económica general y elementos básicos de la empresa." },
        { ciclo: 2, curso: "Lenguaje y Comunicación II", codigo: "6511", creditos: 3, prerrequisitos: ["Lenguaje y Comunicación I"], descripcion: "Consolida habilidades lectoras y desarrolla competencias para la redacción de textos expositivos y argumentativos, y expresión oral formal. Reflexiona sobre las lenguas y el discurso." },
        { ciclo: 2, curso: "Procesos Sociales y Políticos", codigo: "6512", creditos: 3, prerrequisitos: [], descripcion: "Aplica herramientas de las ciencias sociales para comprender la sociedad. Analiza críticamente procesos sociales y políticos actuales, con énfasis en Sociología y Antropología." },
        { ciclo: 2, curso: "Temas de Filosofía", codigo: "6513", creditos: 3, prerrequisitos: [], descripcion: "Introduce al pensamiento filosófico mediante la exploración de problemas del conocimiento, conciencia, moral y sentido de la vida. Fomenta el razonamiento crítico-autónomo." },
        
        { ciclo: 3, curso: "Inteligencia Artificial aplicada", codigo: "560040", creditos: 3, prerrequisitos: [], descripcion: "Aplica los principios fundamentales y herramientas de Inteligencia Artificial en problemas específicos de ingeniería. Aborda fundamentos de IA, programación básica, diseño de ingeniería, IA generativa y desafíos éticos." },
        { ciclo: 3, curso: "Física I", codigo: "560041", creditos: 5, prerrequisitos: ["Cálculo I"], descripcion: "Explica los principios físicos fundamentales como vectores, cinemática, dinámica, energía, momento, oscilaciones, ondas, fluidos y termodinámica, base para la práctica de la ingeniería." },
        { ciclo: 3, curso: "Química general", codigo: "5643", creditos: 4, prerrequisitos: [], descripcion: "Explica los principios de la química moderna y su relación con otras ciencias. Aborda interacciones químicas, reacciones y leyes que rigen estas interacciones en solución y fase gaseosa." },
        { ciclo: 3, curso: "Cálculo II", codigo: "560042", creditos: 5, prerrequisitos: ["Cálculo I"], descripcion: "Explica integrales y series infinitas. Incluye técnicas de integración, convergencia de series, representación de funciones como series de potencias y coordenadas polares." },
        { ciclo: 3, curso: "Sistemas Organizacionales", codigo: "560038", creditos: 2, prerrequisitos: ["Economía y Empresa"], descripcion: "Aplica procedimientos para expresar sistemas organizacionales y subsistemas. Aborda Lenguajes de Modelado Unificado y conceptos de organización desde el enfoque funcional." },
        { ciclo: 3, curso: "Diseño asistido por el Computador", codigo: "560039", creditos: 3, prerrequisitos: ["Álgebra Lineal"], descripcion: "Explica técnicas de modelado mecánico usando software CAD. Aborda modelado 3D, planos 2D, estándares de dibujo de ingeniería y animación/simulación básicas." },
        
        { ciclo: 4, curso: "Costeo de Operaciones", codigo: "560043", creditos: 3, prerrequisitos: ["Sistemas Organizacionales"], descripcion: "Aplica conceptos de costos para determinar el valor económico de operaciones. Aborda estados financieros, sistemas de costeo y elaboración de presupuestos." },
        { ciclo: 4, curso: "Fundamentos de Programación", codigo: "560044", creditos: 3, prerrequisitos: ["Inteligencia Artificial aplicada"], descripcion: "Diseña algoritmos simples mediante lenguajes de programación. Aborda estructuras de control básicas, subrutinas, diseño de modelos basados en datos e IA." },
        { ciclo: 4, curso: "Física II", codigo: "560045", creditos: 5, prerrequisitos: ["Física I"], descripcion: "Explica fenómenos electromagnéticos y estructura de la materia. Aborda circuitos de corriente, magnetismo, óptica y fundamentos de física moderna." },
        { ciclo: 4, curso: "Estadística y Probabilidad", codigo: "560046", creditos: 4, prerrequisitos: ["Cálculo I"], descripcion: "Explica técnicas de estadística descriptiva e inferencial. Aborda probabilidad, variables aleatorias, distribuciones, modelos y estimación de parámetros." },
        { ciclo: 4, curso: "Mecánica", codigo: "5647", creditos: 4, prerrequisitos: ["Física I", "Diseño asistido por el Computador"], descripcion: "Diseña elementos estructurales aplicando principios de Estática y Mecánica de Materiales. Aborda equilibrio en vigas y marcos, esfuerzos y deformaciones." },
        { ciclo: 4, curso: "Cálculo III", codigo: "560047", creditos: 3, prerrequisitos: ["Cálculo II"], descripcion: "Aplica técnicas de cálculo diferencial e integral en varias variables. Aborda curvas y superficies en el espacio y cálculo vectorial." },

        { ciclo: 5, curso: "Investigación de Operaciones I", codigo: "560048", creditos: 4, prerrequisitos: ["Fundamentos de Programación"], descripcion: "Elabora modelos estructurados para resolver problemas de programación lineal. Aborda programación lineal, método simplex, dualidad, programación entera, mixta y por objetivos." },
        { ciclo: 5, curso: "Fundamentos de Operaciones y Logística", codigo: "560049", creditos: 4, prerrequisitos: ["Costeo de Operaciones"], descripcion: "Explica los fundamentos de la gestión de operaciones. Aborda productividad, calidad, mantenimiento y logística." },
        { ciclo: 5, curso: "Ingeniería Económica", codigo: "560050", creditos: 4, prerrequisitos: ["Costeo de Operaciones"], descripcion: "Aplica herramientas de matemática financiera basadas en el valor del dinero en el tiempo. Aborda tasas de interés, decisiones financieras, análisis de reemplazo y sensibilidad." },
        { ciclo: 5, curso: "Electricidad y Electrónica", codigo: "560051", creditos: 3, prerrequisitos: ["Física II"], descripcion: "Explica los principales conceptos eléctricos y electrónicos. Aborda circuitos AC y DC, energía eléctrica, máquinas eléctricas y semiconductores." },
        { ciclo: 5, curso: "Ecuaciones diferenciales", codigo: "560052", creditos: 3, prerrequisitos: ["Cálculo III"], descripcion: "Desarrolla ecuaciones diferenciales ordinarias y sistemas. Aborda integración directa, métodos numéricos, transformada de Laplace y series de potencias." },
        { ciclo: 5, curso: "Diseño de Experimentos", codigo: "560053", creditos: 4, prerrequisitos: ["Estadística y Probabilidad"], descripcion: "Explica técnicas de análisis estadístico. Aborda pruebas de hipótesis, modelos de regresión lineal y logística, intervalos de confianza y estimaciones." },

        { ciclo: 6, curso: "Investigación de operaciones II", codigo: "560054", creditos: 4, prerrequisitos: ["Investigación de Operaciones I"], descripcion: "Resuelve problemas de incertidumbre con métodos de IO. Aborda modelos probabilísticos, cadenas de Markov, colas e inventarios con simulación Montecarlo." },
        { ciclo: 6, curso: "Ergonomía y Diseño del Trabajo", codigo: "560055", creditos: 4, prerrequisitos: ["Estadística y Probabilidad"], descripcion: "Diseña sistemas hombre-máquina considerando normas de ergonomía. Aborda factores humanos, estaciones de trabajo y seguridad ocupacional." },
        { ciclo: 6, curso: "Innovación en Ingeniería", codigo: "560056", creditos: 3, prerrequisitos: ["Electricidad y Electrónica", "Mecánica"], descripcion: "Implementa proyectos de ingeniería. Aborda programación de microcontroladores, diseño CAD y simulación FEA." },
        { ciclo: 6, curso: "Planeamiento y Control de Operaciones", codigo: "560012", creditos: 4, prerrequisitos: ["Fundamentos de Operaciones y Logística"], descripcion: "Evalúa sistemas de planificación y producción. Aborda pronósticos, MRP, JIT/Kanban, programación y teoría de restricciones." },
        { ciclo: 6, curso: "Procesos Industriales", codigo: "560057", creditos: 4, prerrequisitos: ["Química general", "Física II"], descripcion: "Aplica principios de conservación de materia y energía. Aborda balances, operaciones unitarias, movimiento de fluidos y transferencia de calor." },

        { ciclo: 7, curso: "Ingeniería Financiera", codigo: "560058", creditos: 3, prerrequisitos: ["Ingeniería Económica"], descripcion: "Evalúa la situación financiera de organizaciones empresariales. Aborda financiamiento, gestión de riesgos, análisis bursátil y optimización de portafolios." },
        { ciclo: 7, curso: "Diseño de Instalaciones", codigo: "560059", creditos: 3, prerrequisitos: ["Ergonomía y Diseño del Trabajo"], descripcion: "Diseña instalaciones en empresas manufactureras y de servicios. Aborda cálculo de tamaño de planta, localización, layout (SLP) y herramientas Lean." },
        { ciclo: 7, curso: "Inteligencia de Negocios", codigo: "560060", creditos: 3, prerrequisitos: ["Investigación de Operaciones I", "Fundamentos de Operaciones y Logística", "Ingeniería Económica", "Electricidad y Electrónica", "Ecuaciones diferenciales", "Diseño de Experimentos"], descripcion: "Evalúa procesos de negocios mediante análisis de datos. Aborda recopilación, depuración, análisis y comunicación de datos con plataformas de inteligencia empresarial." },
        { ciclo: 7, curso: "Modelos de Sistemas Logísticos", codigo: "560061", creditos: 4, prerrequisitos: ["Fundamentos de Operaciones y Logística"], descripcion: "Construye sistemas de suministro. Aborda función logística, desempeño (KPIs), administración de demanda, pedidos, distribución e inventarios." },
        { ciclo: 7, curso: "Calidad", codigo: "560062", creditos: 3, prerrequisitos: ["Diseño de Experimentos"], descripcion: "Aplica herramientas de calidad. Aborda control estadístico, gráficos de control, muestreo, Six Sigma y metodología DMAIC." },
        { ciclo: 7, curso: "Procesos de Manufactura", codigo: "560063", creditos: 3, prerrequisitos: ["Innovación en Ingeniería"], descripcion: "Diseña piezas mecánicas. Aborda procesos tradicionales y modernos de manufactura, ingeniería aditiva y control numérico computarizado." },

        { ciclo: 8, curso: "Simulación de Procesos", codigo: "560064", creditos: 4, prerrequisitos: ["Investigación de Operaciones I"], descripcion: "Construye modelos de simulación discreta. Aborda recolección de datos, modelado, software de simulación, análisis estadístico y comparación de escenarios." },
        { ciclo: 8, curso: "Modelamiento Predictivo de Datos", codigo: "560065", creditos: 3, prerrequisitos: ["Inteligencia de Negocios"], descripcion: "Evalúa resultados de modelos de predicción. Aborda algoritmos estadísticos, árboles de decisión, redes neuronales y clustering (k-medias)." },
        { ciclo: 8, curso: "Sistemas Integrados de Gestión", codigo: "560066", creditos: 3, prerrequisitos: ["Calidad"], descripcion: "Integra normas de seguridad, calidad y medio ambiente. Aborda interpretación de requisitos, planificación, auditorías y mejora continua." },
        { ciclo: 8, curso: "Gestión de Proyectos", codigo: "560067", creditos: 3, prerrequisitos: ["Investigación de operaciones II", "Ergonomía y Diseño del Trabajo", "Planeamiento y Control de Operaciones", "Procesos Industriales", "Innovación en Ingeniería"], descripcion: "Elabora proyectos con enfoque PMBOK. Aborda fases de gestión, prácticas predictivas y adaptativas, planificación y control de proyectos." },
        { ciclo: 8, curso: "Análisis de Problemas de Ingeniería", codigo: "560068", creditos: 3, prerrequisitos: ["Modelos de Sistemas Logísticos", "Calidad"], descripcion: "Crea propuestas de mejora para procesos empresariales. Aborda diagnóstico, diseño de indicadores, evaluación y resolución de problemas." },
        { ciclo: 8, curso: "Automatización Industrial", codigo: "560069", creditos: 3, prerrequisitos: ["Procesos de Manufactura"], descripcion: "Aplica manufactura integrada por computador. Aborda CNC, FMS, CAD/CAM/CAE, control de procesos, redes y automatización industrial." },

        { ciclo: 9, curso: "Ética y Gestión Humana", codigo: "560070", creditos: 3, prerrequisitos: [], descripcion: "Aplica conceptos éticos en la práctica de la ingeniería, con énfasis en la gestión de talento humano. Aborda estándares éticos, motivación, rendimiento y compensaciones." },
        { ciclo: 9, curso: "Proyecto de Ingeniería Aplicada I", codigo: "560071", creditos: 4, prerrequisitos: ["Análisis de Problemas de Ingeniería"], descripcion: "Primera etapa de diseño de solución ante un problema de ingeniería. Aborda diagnóstico causa-raíz, identificación de oportunidades y diseño de modelos dentro de líneas de investigación." },
        { ciclo: 9, curso: "Ingeniería Comercial", codigo: "560072", creditos: 3, prerrequisitos: ["Modelos de Sistemas Logísticos"], descripcion: "Evalúa la gestión del proceso comercial usando herramientas innovadoras. Aborda segmentación de mercados, comportamiento del consumidor, marketing, ventas y CRM." },

        { ciclo: 10, curso: "Proyecto de Ingeniería Aplicada II", codigo: "560073", creditos: 4, prerrequisitos: ["Proyecto de Ingeniería Aplicada I", "Simulación de Procesos"], descripcion: "Segunda etapa del proyecto de ingeniería. Evalúa viabilidad del modelo propuesto mediante simulación crítica de un caso real." },
        { ciclo: 10, curso: "Gerencia Estratégica", codigo: "560074", creditos: 4, prerrequisitos: ["Ingeniería Financiera", "Ingeniería Comercial"], descripcion: "Crea un plan estratégico competitivo. Aborda análisis estratégico, formulación de estrategias, Balanced Scorecard y modelo GRC." },
],

      personalizada: JSON.parse(localStorage.getItem("cursosPersonalizados")) || []
    };

    let carreraActual = 'ingenieria';
    const estadoCursos = JSON.parse(localStorage.getItem("estadoCursosULIMA")) || {};

    function guardarCursosPersonalizados() {
      localStorage.setItem("cursosPersonalizados", JSON.stringify(carreras.personalizada));
    }

    function lanzarConfetti() {
      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    }
    function cambiarTab(tab) {
  document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(div => div.classList.remove("active", "hidden"));

  if (tab === "eval") {
    document.querySelector(".tab-button:nth-child(1)").classList.add("active");
    document.getElementById("tab-eval").classList.add("active");
  } else {
    document.querySelector(".tab-button:nth-child(2)").classList.add("active");
    document.getElementById("tab-notas").classList.add("active");
  }
}


    function mostrarAlerta(mensaje) {
      const alerta = document.createElement("div");
      alerta.className = "alerta-desbloqueo";
      alerta.innerHTML = `<img src="https://media.giphy.com/media/L0a0RgItTjX3WgYgKn/giphy.gif" alt="Desbloqueado"> <span>${mensaje}</span>`;
      document.body.appendChild(alerta);
      setTimeout(() => alerta.remove(), 3000);
    }
function renderPopup(curso) {
  const popup = document.getElementById("popup");
  const overlay = document.getElementById("overlay");
  const prerreq = curso.prerrequisitos.length ? curso.prerrequisitos.join(", ") : "Ninguno";
  const evaluaciones = JSON.parse(localStorage.getItem("evaluaciones_" + curso.curso)) || [];
  const notaGuardada = localStorage.getItem("nota_" + curso.curso) || "";

  let promedio = 0;
  let totalPeso = 0;
  evaluaciones.forEach(ev => {
    promedio += ev.peso * ev.nota;
    totalPeso += ev.peso;
  });
  promedio = totalPeso > 0 ? (promedio / totalPeso).toFixed(2) : "-";

  popup.innerHTML = `
    <div class="popup-tabs">
      <button class="tab-button active" onclick="cambiarTabPopup('info')"> Información</button>
      <button class="tab-button" onclick="cambiarTabPopup('eval')"> Evaluaciones</button>
      <button class="tab-button" onclick="cambiarTabPopup('notas')">📝 Notas</button>
    </div>

    <div id="tab-info" class="tab-content active">
      <h3>${curso.curso}</h3>
      <small><strong>Código:</strong> ${curso.codigo}</small><br>
      <small><strong>Créditos:</strong> ${curso.creditos}</small><br>
      <small><strong>Prerrequisitos:</strong> ${prerreq}</small>
      <p style="margin-top: 0.5em;">${curso.descripcion}</p>

      ${curso.curso === "Costeo de Operaciones" ? `
        <div style="background:#ffe9ec; color:#d94e6a; border-radius:0.5em; padding:0.8em; margin:1em 0;">
          <strong>⚠️ Nota importante:</strong><br>
          Si cursaste <b>Costeo de Operaciones</b> antes del ciclo 2025-1, el curso tenía <b>2 créditos</b>.<br>
          Desde 2025-1 el curso tiene <b>3 créditos</b>.<br>
          Considera esto para tu avance curricular.
        </div>
      ` : ""}
    </div>

    <div id="tab-eval" class="tab-content hidden">
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr><th>Evaluación</th><th>%</th><th>Nota</th><th></th></tr>
        </thead>
        <tbody>
          ${evaluaciones.map((ev, i) => `
            <tr>
              <td>${ev.nombre}</td>
              <td>${(ev.peso * 100).toFixed(0)}%</td>
              <td>${ev.nota}</td>
              <td><button onclick="eliminarEval('${curso.curso}', ${i})">❌</button></td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      <form onsubmit="agregarEval(event, '${curso.curso}')" style="margin-top: 0.5em;">
        <input type="text" placeholder="Nombre" id="eval-nombre" required>
        <input type="number" placeholder="%" id="eval-peso" min="0" max="100" required>
        <input type="number" placeholder="Nota" id="eval-nota" step="0.1" min="0" max="20" required>
        <button type="submit">➕ Agregar</button>
      </form>
      <p><strong>Promedio:</strong> <span id="promedio-curso">${promedio}</span></p>
    </div>

    <div id="tab-notas" class="tab-content hidden">
      <textarea id="nota-personal" placeholder="Escribe tus notas personales aquí..." rows="6" style="width: 100%;">${notaGuardada}</textarea>
    </div>

    <br><button onclick="cerrarPopup()">Cerrar</button>
  `;

  popup.querySelector("#nota-personal").addEventListener("input", e => {
    localStorage.setItem("nota_" + curso.curso, e.target.value);
  });

  popup.classList.remove("hidden");
  overlay.classList.remove("hidden");
}

    function cerrarPopup() {
      document.getElementById("popup").classList.add("hidden");
      document.getElementById("overlay").classList.add("hidden");
    }

    function cambiarCarrera(nombre) {
      document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.tabs button[onclick*="${nombre}"]`).classList.add('active');
      carreraActual = nombre;
      document.getElementById("formulario-personalizado").classList.toggle("hidden", nombre !== "personalizada");
        if (nombre === "personalizada") {
        document.getElementById('electivos-contenedor').style.display = 'none';
      } else {
        document.getElementById('electivos-contenedor').style.display = '';
      }
      renderMalla();
    }

    function agregarCurso(e) {
      e.preventDefault();
      const nombre = document.getElementById("curso-nombre").value;
      const codigo = document.getElementById("curso-codigo").value;
      const creditos = parseInt(document.getElementById("curso-creditos").value);
      const cicloText = targetCol.querySelector(".ciclo-title")?.textContent || "";
      const ciclo = parseInt(cicloText.replace("Ciclo ", "")) || 1;
      const prerreq = document.getElementById("curso-prerreq").value.split(",").map(p => p.trim()).filter(Boolean);
      const descripcion = document.getElementById("curso-descripcion").value;
      carreras.personalizada.push({ curso: nombre, codigo, creditos, ciclo, prerrequisitos: prerreq, descripcion });
      guardarCursosPersonalizados();
      e.target.reset();
      renderMalla();
    }

    function editarCurso(nombre) {
      const curso = carreras.personalizada.find(c => c.curso === nombre);
      if (!curso) return;
      document.getElementById("curso-nombre").value = curso.curso;
      document.getElementById("curso-codigo").value = curso.codigo;
      document.getElementById("curso-creditos").value = curso.creditos;
      document.getElementById("curso-ciclo").value = curso.ciclo;
      document.getElementById("curso-prerreq").value = curso.prerrequisitos.join(", ");
      document.getElementById("curso-descripcion").value = curso.descripcion;
      carreras.personalizada = carreras.personalizada.filter(c => c.curso !== nombre);
      guardarCursosPersonalizados();
      renderMalla();
    }
    function cambiarTabPopup(tab) {
      document.querySelectorAll(".popup-tabs .tab-button").forEach(btn => btn.classList.remove("active"));
      document.querySelectorAll(".tab-content").forEach(div => div.classList.remove("active"));

      document.querySelector(`.popup-tabs .tab-button[onclick*="${tab}"]`).classList.add("active");
      document.getElementById(`tab-${tab}`).classList.add("active");
    }

    function eliminarCurso(nombre) {
      if (!confirm(`¿Eliminar "${nombre}"?`)) return;
      carreras.personalizada = carreras.personalizada.filter(c => c.curso !== nombre);
      guardarCursosPersonalizados();
      renderMalla();
    }
    const nombreDiploma = {
      IT: "Innovación Tecnológica",
      BA: "Business Analytics",
      SCM: "Supply Chain Management",
      EPM: "Engineering Project Management",
      IE: "Ingeniería Empresarial",
      ninguno: "Sin diploma"
    };
    function renderMalla() {
      let cursos = carreras[carreraActual];
      const container = document.getElementById("malla");
      const ciclos = [...new Set(cursos.map(c => c.ciclo))].sort((a,b) => a-b);
      container.innerHTML = "";

      cursos.forEach(curso => {
        const fueBloqueado = curso.prerrequisitos.some(pre => !estadoCursos[pre]);
        const ahoraDesbloqueado = curso.prerrequisitos.every(pre => estadoCursos[pre]);
        if (!estadoCursos[curso.curso] && fueBloqueado && ahoraDesbloqueado && localStorage.getItem("estadoCursosULIMA")) {
          mostrarAlerta(`¡Ya puedes llevar \"${curso.curso}\"!`);
        }
      });

      ciclos.forEach(ciclo => {
        const col = document.createElement("div");
        col.className = "ciclo-col";
        col.innerHTML = `<div class="ciclo-title">Ciclo ${ciclo}</div>`;

      cursos
  .filter(c => c.ciclo === ciclo)
  .filter(curso => {
    // Si estamos en la pestaña personalizada, NO mostrar cursos electivos
    if (carreraActual === "personalizada") {
      return !cursosElectivos.some(e => e.curso === curso.curso);
    }
    return true;
  })
  .forEach(curso => {
          const card = document.createElement("div");
          card.className = "curso";
          if (cursosElectivos.some(e => e.curso === curso.curso)) {
              habilitarBotonEliminarElectivo(card, curso);
          }
          card.dataset.nombre = curso.curso;

          const creditosCompletados = Object.entries(estadoCursos)
            .filter(([_, aprobado]) => aprobado)
            .map(([nombre]) => {
              const cursoEncontrado = carreras[carreraActual].find(c => c.curso === nombre);
              return cursoEncontrado ? cursoEncontrado.creditos : 0;
            })
            .reduce((a, b) => a + b, 0);

          const estaBloqueado = curso.prerrequisitos.some(pre => {
            if (pre.startsWith("créditos:")) {
              const requeridos = parseInt(pre.split(":")[1]);
              return creditosCompletados < requeridos;
            }
            return !estadoCursos[pre];
          });
          if (estaBloqueado) card.classList.add("bloqueado");
          if (estadoCursos[curso.curso]) card.classList.add("completado");

let badge = "";
const electivoData = cursosElectivos.find(e => e.curso === curso.curso);
if (electivoData) {
  if (Array.isArray(electivoData.diploma)) {
    badge = electivoData.diploma.map(sigla =>
      `<span class="badge ${sigla}" title="${nombreDiploma[sigla] || sigla}">${sigla}</span>`
    ).join(" ");
  } else if (electivoData.diploma && electivoData.diploma !== "ninguno") {
    badge = `<span class="badge ${electivoData.diploma}" title="${nombreDiploma[electivoData.diploma] || electivoData.diploma}">${electivoData.diploma}</span>`;
  } else {
    badge = `<span class="badge ninguno" title="Sin diploma">Sin diploma</span>`;
  }
}
let alertaIcono = "";
if (curso.curso === "Costeo de Operaciones") {
  alertaIcono = `<span class="alerta-sirena" title="¡Atención! Cambió de 2 a 3 créditos desde 2025-1">🚨</span>`;
}

card.innerHTML = `
  <div class="curso-title">${alertaIcono} ${curso.curso}</div>
  ${badge}
  <small><strong>Código:</strong> ${curso.codigo}</small>
  <small><strong>Créditos:</strong> ${curso.creditos}</small>
  <div class="info-btn">i</div>
`;


          card.querySelector(".info-btn").addEventListener("click", e => {
            e.stopPropagation();
            renderPopup(curso);
          });

          if (carreraActual === 'personalizada') {
            const actions = document.createElement('div');
            actions.className = 'action-btn';
            actions.innerHTML = `
              <button onclick="event.stopPropagation(); editarCurso('${curso.curso}')">✏️</button>
              <button onclick="event.stopPropagation(); eliminarCurso('${curso.curso}')">🗑️</button>
            `;
            card.appendChild(actions);
          }
          else if (cursosElectivos.some(e => e.curso === curso.curso)) {
            const actions = document.createElement('div');
            actions.className = 'action-btn';
            actions.innerHTML = `
              <button onclick="event.stopPropagation(); quitarElectivo('${curso.curso}')">🔙 Quitar</button>
            `;
            card.appendChild(actions);
          }
          card.addEventListener("click", () => {
            if (!estaBloqueado) {
              estadoCursos[curso.curso] = !estadoCursos[curso.curso];
              localStorage.setItem("estadoCursosULIMA", JSON.stringify(estadoCursos));
              renderMalla();
              if (estadoCursos[curso.curso]) lanzarConfetti();
            }
          });

          col.appendChild(card);
        });

        container.appendChild(col);
      });
      mostrarCreditosAprobados();
    }
    function mostrarCreditosAprobados() {
  const creditosTotales = 205; // ← Ajusta este número si tu carrera tiene otro total
  const creditosCompletados = Object.entries(estadoCursos)
    .filter(([_, aprobado]) => aprobado)
    .map(([nombre]) => {
      const cursoEncontrado = carreras[carreraActual].find(c => c.curso === nombre);
      return cursoEncontrado ? cursoEncontrado.creditos : 0;
    })
    .reduce((a, b) => a + b, 0);

  const porcentaje = Math.min(100, Math.round((creditosCompletados / creditosTotales) * 100));

  document.getElementById("creditos-texto").textContent = `Créditos aprobados: ${creditosCompletados} / ${creditosTotales}`;
  document.getElementById("creditos-barra").style.width = `${porcentaje}%`;
}

    const cursosElectivos = [
  {
    ciclo: 10,
    curso: "TRANSFORMACIÓN DIGITAL",
    codigo: "560081",
    creditos: 3,
    prerrequisitos: [
	"Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante diseña una estrategia de digitalización para una organización. Esta asignatura aborda la importancia de la Transformación Digital en el contexto actual, la innovación y sus diversos tipos, big data (arquitectura, roles, tecnologías, lenguajes de programación, machine learning), internet de las cosas, blockchain y economía de plataformas.",
    diploma: ["BA","IT"]
  },
  {
    ciclo: 8,
    curso: "INTRODUCCIÓN A SISTEMAS DE GESTIÓN DE BASES DE DATOS",
    codigo: "560082",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante resuelve problemas de la gestión de operaciones mediante el uso de base de datos. Esta asignatura emplea aulas de cómputo y se aborda el diseño de bases de datos, la gestión de los datos, el desarrollo de consultas mediante software especializado y los aspectos relacionados a la protección e integración de los datos.",
    diploma: ["BA"]
  },
  {
    ciclo: 10,
    curso: "ESTRATEGIA DE INTELIGENCIA EMPRESARIAL",
    codigo: "560083",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa situaciones empresariales mediante el análisis de datos. Esta asignatura aborda los conceptos básicos de Business Analytics, los fundamentos de la gestión y manipulación de datos, las técnicas para describir y resumir datos, los modelos predictivos y herramientas para la optimización de decisiones empresariales.",
    diploma: ["BA"]
  },
  {
    ciclo: 10,
    curso: "ROBOTIC PROCESS AUTOMATION",
    codigo: "560092",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante utiliza herramientas analíticas para automatizar tareas de baja complejidad. Esta asignatura emplea aulas de cómputo y aborda la captura de datos de múltiples fuentes y las reglas para su procesamiento, modelos de decisión simples basados en reglas lógicas predefinidas y la interacción con otros sistemas y aplicaciones.",
    diploma: ["BA"]
  },
  {
    ciclo: 9,
    curso: "MACHINE LEARNING",
    codigo: "560093",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante analiza los resultados de modelos centrados en el aprendizaje autónomo de las máquinas a partir de datos. Esta asignatura emplea aulas de cómputo y aborda métodos de aprendizaje supervisado y no supervisado.",
    diploma: ["BA"]
  },
  {
    ciclo: 9,
    curso: "HERRAMIENTAS INFORMÁTICAS",
    codigo: "560094",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante diseña soluciones computacionales a través del uso de algoritmos para la mejora de los procesos. Esta asignatura emplea aulas de cómputo y aborda diversas herramientas informáticas.",
    diploma: ["BA"]
  },
  {
    ciclo: 9,
    curso: "FORMULACIÓN Y EVALUACIÓN DE PROYECTOS",
    codigo: "5662",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa la viabilidad de un proyecto de inversión. Esta asignatura aborda los conceptos y criterios metodológicos relacionados a la formulación de un proyecto, la estructuración de los fondos de capital, los costos y presupuestos, así como el dimensionamiento de las variables para la toma de decisiones a través de la generación de escenarios económicos, financieros y sociales.",
    diploma: ["EPM"]
  },
  {
    ciclo: 9,
    curso: "METODOLOGÍAS ÁGILES",
    codigo: "560032",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante diseña un proyecto a través del uso de soluciones ágiles y dinámicas para crear equipos y organizaciones que se adaptan rápidamente a entornos competitivos. Esta asignatura aborda conceptos como Scrum, Kanban, Lean, XP y DevOps.",
    diploma: ["EPM"]
  },
  {
    ciclo: 10,
    curso: "DIRECCIÓN EN IMPLEMENTACIÓN DE PROYECTOS",
    codigo: "560035",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante aplica una metodología de implementación de proyectos. Esta asignatura aborda la identificación, priorización y programación de actividades, PERT-CPM, la ejecución y control de tiempos, costos, calidad y riesgos de los recursos asignados a un proyecto.",
    diploma: ["EPM"]
  },
  {
    ciclo: 8,
    curso: "GESTIÓN DE OPERACIONES DE SERVICIOS",
    codigo: "5685",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante diseña estrategias para gestionar y optimizar las operaciones de una empresa de servicios a través del uso de herramientas de ingeniería. Esta asignatura aborda la participación del cliente en los procesos de servicio, posicionamiento en mercados competitivos, creación de servicios con valor agregado, diseño de sistemas de entrega, administración de la demanda y capacidad, overbooking y blueprint, administración de quejas y recuperación del servicio.",
    diploma: ["EPM"]
  },
  {
    ciclo: 10,
    curso: "GESTIÓN DE RECURSOS",
    codigo: "560098",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante aplica la gestión de recursos del proyecto siguiendo la metodología del PMBOK. Esta asignatura aborda conceptos de operaciones y productividad, recursos en gestión de proyectos, recursos humanos y diseño de trabajos, cadena de suministro, gestión de inventario y programación",
    diploma: ["EPM"]
  },
  {
    ciclo: 10,
    curso: "GESTIÓN DE RIESGOS Y PORTAFOLIOS",
    codigo: "560099",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante aplica la gestión de riesgos del proyecto siguiendo la metodología del PMBOK. Esta asignatura aborda la identificación de riesgos, la gestión cualitativa, cuantitativa, el tratamiento de riesgos, el seguimiento y la revisión de los procesos del proyecto.",
    diploma: ["EPM"]
  },
  {
    ciclo: 10,
    curso: "JUEGO DE NEGOCIOS",
    codigo: "5673",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa el desempeño del negocio. Esta asignatura aborda sesiones de juego mediante un simulador y software especializado que permiten relacionar, a través de herramientas, las diversas áreas de una empresa como planeación, ventas, producción y su efecto en el resultado financiero.",
    diploma: ["SCM","IE"]
  },
  {
    ciclo: 9,
    curso: "GESTIÓN DEL COMERCIO INTERNACIONAL",
    codigo: "560087",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
      "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa los mecanismos relacionados al comercio internacional. Esta asignatura aborda los fundamentos y procedimientos del comercio internacional, logística internacional, fletes, seguros, aranceles, medios de pago y financiamiento internacional. Asimismo,	explora el desarrollo y promoción de exportaciones, considerando los regímenesespeciales en el comercio internacional.", 
    diploma: ["IE"]
  },
  {
    ciclo: 8,
    curso: "CREATIVIDAD, INNOVACIÓN Y EMPRENDIMIENTO",
    codigo: "560088",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
     "Es una asignatura de naturaleza teórica, en la que el estudiante diseña productos o servicios innovadores, a través del análisis de las características y oportunidades para el desarrollo de emprendimientos. Esta asignatura explora el proceso de creatividad, las metodologías y herramientas de innovación y las técnicas de prototipado. Asimismo, aborda 	las competencias emprendedoras y técnicas creativas.",
    diploma: ["IE"]
  },
  {
    ciclo: 10,
    curso: "GERENCIA B2B",
    codigo: "560029",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa la gestión de clientes empresariales para mejorar los resultados de los equipos comerciales. Esta asignatura aborda temas como segmentación empresarial de clientes, marketing industrial, trade marketing institucional, el proceso de ventas, ventas consultivas y el desarrollo de 	estrategias comerciales B2B.",
    diploma: ["IE"]
  },
  {
    ciclo: 9,
    curso: "HERRAMIENTAS DE MARKETING DIGITAL",
    codigo: "560005",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante crea estrategias de marketing digital para la captación de potenciales clientes y su fidelización. Esta asignatura aborda herramientas del marketing digital como el SMO (Social Media Optimization), SEM (Search Engine Marketing) y SEO (Search Engine Optimization). Así como la gestión 	de redes sociales, la gestión de procesos digitales e inboud marketing",
    diploma: ["IE"]
  },
  {
    ciclo: 10,
    curso: "SOSTENIBILIDAD INDUSTRIAL",
    codigo: "560100",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante analiza los conceptos relacionados con la sostenibilidad y su importancia en el contexto global y local, a través del impacto de las ODS en la gestión de las organizaciones. Esta asignatura aborda cada una de las dimensiones del desarrollo sostenible, así como la relación entre 	desarrollo sostenible y responsabilidad social.",
    diploma: ["IE"]
  },
  {
    ciclo: 9,
    curso: "GESTIÓN DE PROYECTOS DE DISEÑO",
    codigo: "560079",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante elabora proyectos de diseño para el mercado de un nuevo producto. Esta asignatura aborda conceptos de proyectos, planificación y control de proyectos, presupuesto y cálculo de costos, viabilidad y gestión de proyectos.",
    diploma: ["IT"]
  },
  {
    ciclo: 8,
    curso: "TECNOLOGÍA INDUSTRIAL",
    codigo: "560080",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante aplica las operaciones y procesos industriales para el procesamiento de materiales y productos. Esta asignatura aborda las técnicas de diagrama de flujo, de bloques, métodos de tratamiento de agua, fuentes de energía, métodos de obtención de gases industriales, fabricación de 	fertilizantes, cementos, detergentes y producción de plásticos.",
    diploma: ["IT"]
  },
  {
    ciclo: 10,
    curso: "DISEÑO DE PROYECTOS SOSTENIBLES",
    codigo: "560089",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
	  "Es una asignatura de naturaleza teórico-práctica, en la que el estudiante diseña proyectos empresariales sostenibles y con responsabilidad social. Esta asignatura aborda herramientas de gestión de proyectos, metodologías y habilidades para la incorporación de expectativas de grupos de interés, y los conceptos de sostenibilidad, triple línea 	base e impacto de los proyectos.",
    diploma: ["IT"]
  },
  {
    ciclo: 10,
    curso: "TECNOLOGÍAS DE PROGRAMACIÓN",
    codigo: "560090",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
    "Es una asignatura de naturaleza teórico-práctica, en la que el estudiante explica los conceptos básicos de la construcción de software para computadoras. Esta asignatura aborda variables, flujos de datos, planteamiento de algoritmos, técnicas de análisis de algoritmo, estructura básica de datos, algoritmos de búsqueda y algoritmos de ordenamiento e interacción con archivos.",
    diploma: ["IT"]
  },
  {
    ciclo: 9,
    curso: "DISEÑO Y PROTOTIPADO",
    codigo: "560091",
    creditos: 3,
    prerrequisitos: ["Ingeniería Financiera","Diseño de Instalaciones","Inteligencia de Negocios","Modelos de Sistemas Logísticos","Calidad","Procesos de Manufactura"],
    descripcion:
	  "Es una asignatura de naturaleza teórica, en la que el estudiante produce prototipos de productos y maquetas interactivas de sitios web o aplicaciones móviles. Esta asignatura aborda tipos de impresión de prototipado como modelado por deposición fundida (FDM), sinterizado selectivo por láser (SLS), estereolitografía (SLA), impresión 3D de gran acabado y precisión (Polyjet) y fabricación aditiva con plástico en polvo (3DP).",
    diploma: ["IT"]
  },
  {
    ciclo: 9,
    curso: "SUPPLY CHAIN MANAGEMENT",
    codigo: "560084",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante construye redes de la cadena de suministros. Esta asignatura aborda de manera integrada los conceptos de producción, el control de inventario, la selección de proveedores, la gestión de riesgos y el diseño de la red logística.",
    diploma: ["SCM"]
  },
  {
    ciclo: 9,
    curso: "COMPRAS Y GESTIÓN DEL ABASTECIMIENTO",
    codigo: "560085",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa el diseño del sistema de flujo de materiales. Esta asignatura aborda los conceptos como la ubicación de las instalaciones, los sistemas de aprovisionamiento y los sistemas de almacén/inventario",
    diploma: ["SCM"]
  },
  {
    ciclo: 8,
    curso: "LEAN SIX SIGMA",
    codigo: "560095",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante aplica herramientas Lean y Six Sigma sobre problemas de producción. Esta asignatura aborda conceptos de Lean, como 5S´s, flujo continuo, SMED, mecanismos Poka Yoke, Kanban, mapeo de la cadena de valor, mejora continua Kaizen; y la metodología DMAIC.",
    diploma: ["SCM"]
  },
  {
    ciclo: 10,
    curso: "PROCESOS LOGÍSTICOS ERP/ ERP PROCESS WORKSHOP",
    codigo: "560096",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripcion:
    "La asignatura de naturaleza teórico, en la que el estudiante diseña procesos logísticos en un sistema ERP. Esta asignatura aborda conceptos como la creación de data maestra, proceso de compras, gestión de demanda, planeamiento (MPS/MRP) y producción.",
    diploma: ["SCM"]
  },
  {
    ciclo: 10,
    curso: "INGENIERÍA DEL TRANSPORTE Y DISTRIBUCIÓN",
    codigo: "560097",
    creditos: 3,
    prerrequisitos: ["créditos:120"],
    descripción:
    "Es una asignatura de naturaleza teórica, en la que el estudiante evalúa el diseño del sistema de flujo de materiales hacia los clientes. Esta asignatura aborda los conceptos como la ubicación de los centros de distribución y los sistemas de distribución/transporte.",
    diploma: ["SCM"]
  },
  {
  ciclo: 6,
  curso: "GLOBALIZACIÓN, CAPITALISMO Y CIENCIA EN EL MUNDO CONTEMPORÁNEO",
  codigo: "560075",
  creditos: 3,
  prerrequisitos: ["créditos:80"],
  descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante examina la relación de los problemas del mundo contemporáneo y la situación actual del Perú con un énfasis en la revolución industrial y tecnológica actual. Esta asignatura aborda los principales procesos y fenómenos que han surgido desde la guerra fría, la consolidación de la globalización, la influencia del capitalismo mundial, los avances científicos en la sociedad, la cultura y geopolítica actual.",
  diploma: ["Sin Diploma"]
},
{
  ciclo: 6,
  curso: "TALLER DE LIDERAZGO",
  codigo: "560076",
  creditos: 3,
  prerrequisitos: ["créditos:80"],
  descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante utiliza herramientas y recursos que permiten el cambio y la transformación de la persona. Esta asignatura aborda temas como perfiles de liderazgo, marketing personal, comunicación asertiva, desarrollo de habilidades personales, inteligencia emocional, plan de vida, motivaciones y metas personales.",
  diploma: ["Sin Diploma"]
},
{
  ciclo: 6,
  curso: "PROGRAMACIÓN PARA INGENIERÍA",
  codigo: "560077",
  creditos: 3,
  prerrequisitos: ["créditos:80"],
  descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante diseña algoritmos y programas de alto nivel. Esta asignatura aborda la programación orientada a objetos, la manipulación de datos, la conexión y consulta a bases de datos.",
  diploma: ["Sin Diploma"]
},
{
  ciclo: 7,
  curso: "SISTEMAS DE INFORMACIÓN GERENCIAL",
  codigo: "560078",
  creditos: 3,
  prerrequisitos: ["créditos:100"],
  descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante elabora un proyecto de sistemas mediante el uso de una metodología de desarrollo. Esta asignatura aborda los recursos que conforman los sistemas y tecnologías de la información, para el desarrollo de proyectos, cada una con sus propias características, enfoques y procesos.",
  diploma: ["Sin Diploma"]
},
{
  ciclo: 7,
  curso: "TALLER DE HABILIDADES GERENCIALES",
  codigo: "5665",
  creditos: 3,
  prerrequisitos: ["créditos:100"],
  descripcion:
    "Es una asignatura de naturaleza teórica, en la que el estudiante utiliza técnicas, herramientas y recursos que le permiten conseguir metas y objetivos organizacionales. Esta asignatura aborda el pensamiento estratégico, la negociación, el manejo de conflictos, la administración eficiente del tiempo y el manejo de estrés. Adicionalmente, ésta enfatiza en el coaching y gestión de equipos en los procesos de cambio.",
  diploma: ["Sin Diploma"]
}

];
let diplomaSeleccionado = "todos";

function renderElectivos() {
  const container = document.getElementById("electivos-container");
  container.innerHTML = "";

cursosElectivos
  .filter(curso =>
    diplomaSeleccionado === 'todos' ||
    (Array.isArray(curso.diploma)
      ? curso.diploma.includes(diplomaSeleccionado)
      : curso.diploma === diplomaSeleccionado) ||
    (diplomaSeleccionado === 'ninguno' && !curso.diploma)
  )
    .forEach(curso => {
      const card = document.createElement("div");
      card.className = "electivo";
      card.setAttribute("draggable", "true");
      card.dataset.curso = curso.curso;
      card.dataset.ciclo = curso.ciclo;

      let badge = "";
      if (Array.isArray(curso.diploma)) {
        badge = curso.diploma.map(sigla =>
          `<span class="badge ${sigla}" title="${nombreDiploma[sigla] || sigla}">${sigla}</span>`
        ).join(" ");
      } else if (curso.diploma && curso.diploma !== "ninguno") {
        badge = `<span class="badge ${curso.diploma}" title="${nombreDiploma[curso.diploma] || curso.diploma}">${curso.diploma}</span>`;
      } else {
        badge = `<span class="badge ninguno" title="Sin diploma">Sin diploma</span>`;
      }

      card.innerHTML = `
        <div class="curso-title">${curso.curso}</div>
        ${badge}
        <small><strong>Código:</strong> ${curso.codigo}</small>
        <small><strong>Créditos:</strong> ${curso.creditos}</small>
        <div class="info-btn">i</div>   <!-- ✅ ESTE DIV FALTABA -->
      `;

      card.querySelector(".info-btn").addEventListener("click", e => {
        e.stopPropagation();
        renderPopup(curso);
      });

      card.addEventListener("dragstart", () => {
        card.classList.add("dragging");
      });

      card.addEventListener("dragend", () => {
        card.classList.remove("dragging");
      });

      container.appendChild(card);
    });
}
function agregarEval(event, cursoNombre) {
  event.preventDefault();
  const nombre = document.getElementById("eval-nombre").value;
  const peso = parseFloat(document.getElementById("eval-peso").value) / 100;
  const nota = parseFloat(document.getElementById("eval-nota").value);

  const evaluaciones = JSON.parse(localStorage.getItem("evaluaciones_" + cursoNombre)) || [];
  evaluaciones.push({ nombre, peso, nota });
  localStorage.setItem("evaluaciones_" + cursoNombre, JSON.stringify(evaluaciones));
  renderPopup({ ...carreras[carreraActual].find(c => c.curso === cursoNombre) });
}

function eliminarEval(cursoNombre, index) {
  const evaluaciones = JSON.parse(localStorage.getItem("evaluaciones_" + cursoNombre)) || [];
  evaluaciones.splice(index, 1);
  localStorage.setItem("evaluaciones_" + cursoNombre, JSON.stringify(evaluaciones));
  renderPopup({ ...carreras[carreraActual].find(c => c.curso === cursoNombre) });
}
    function filtrarDiploma(clave) {
      diplomaSeleccionado = clave;
      document.querySelectorAll(".filtros-diplomas button").forEach(btn => btn.classList.remove("active"));
      document.querySelector(`.filtros-diplomas button[onclick*="${clave}"]`).classList.add("active");
      renderElectivos();
    }

    window.onload = () => {
      renderMalla();
      filtrarDiploma("todos");
      mostrarCreditosAprobados();
    };
document.addEventListener("DOMContentLoaded", () => {
  const malla = document.getElementById("malla");

  malla.addEventListener("dragover", e => {
    e.preventDefault();
    const dragged = document.querySelector(".electivo.dragging");
    if (dragged && e.target.closest(".ciclo-col")) {
      const targetCol = e.target.closest(".ciclo-col");
      targetCol.appendChild(dragged);

      const nombreCurso = dragged.dataset.curso;
      const cicloText = targetCol.querySelector(".ciclo-title")?.textContent || "";
      const ciclo = parseInt(cicloText.replace("Ciclo ", "")) || 1;

      const encontrado = cursosElectivos.find(c => c.curso === nombreCurso);
      if (encontrado && !carreras[carreraActual].some(c => c.curso === encontrado.curso)) {
        carreras[carreraActual].push({ ...encontrado, ciclo });
        renderMalla();
        renderElectivos();
        estadoCursos[encontrado.curso] = false;
        localStorage.setItem("estadoCursosULIMA", JSON.stringify(estadoCursos));
      }
    }
  });
});
  // Permitir regresar electivos desde la malla general
function habilitarBotonEliminarElectivo(card, curso) {
  const boton = document.createElement("button");
  boton.innerText = "⏪";
  boton.title = "Quitar de la malla y devolver a Electivos";
  boton.style.position = "absolute";
  boton.style.bottom = "0.5rem";
  boton.style.left = "0.5rem";
  boton.style.background = "transparent";
  boton.style.border = "none";
  boton.style.cursor = "pointer";
  boton.style.color = "#d94e6a";
  boton.style.fontSize = "14px";

  boton.addEventListener("click", (e) => {
    e.stopPropagation();
    // Eliminar de la malla
    const index = carreras[carreraActual].findIndex(c => c.curso === curso.curso);
    if (index !== -1) {
      carreras[carreraActual].splice(index, 1);
      // Borrar su estado (completado o no)
      delete estadoCursos[curso.curso];
      localStorage.setItem("estadoCursosULIMA", JSON.stringify(estadoCursos));
      renderMalla();
      renderElectivos();
    }
  });

  card.appendChild(boton);
}
function quitarElectivo(nombreCurso) {
  // Eliminar de la malla
  carreras[carreraActual] = carreras[carreraActual].filter(c => c.curso !== nombreCurso);
  
  // También quitar su estado si tenía alguno
  delete estadoCursos[nombreCurso];
  localStorage.setItem("estadoCursosULIMA", JSON.stringify(estadoCursos));

  mostrarCreditosAprobados();
  renderMalla();
  renderElectivos();
}
  </script>
</body>
</html>
